<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator｜Simple Tools</title>
    <meta name="description" content="URLやテキストから高品質なQRコードを生成。色、サイズ、誤り訂正レベルをカスタマイズしてPNGダウンロード可能。" />

    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4KCLTYQ3D1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-4KCLTYQ3D1');
    </script>
</head>

<body>
    <header>
        <h1>QR Code Generator</h1>
        <p class="subtitle">カスタムQRコード作成</p>
    </header>

    <div class="back-nav">
        <a href="/"><span>←</span> Home</a>
    </div>

    <main class="tool-container two-col-layout">

        <!-- Controls -->
        <div class="control-panel">
            <h2 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--primary);">設定</h2>

            <div class="input-group">
                <label>QR Content (URL / Text)</label>
                <textarea id="in-text" rows="3" placeholder="https://example.com">https://example.com</textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                <div class="input-group">
                    <label>Size (px)</label>
                    <input type="number" id="in-size" value="300" min="50" max="2000" step="10">
                </div>
                <div class="input-group">
                    <label>Correction Level</label>
                    <select id="in-level" style="width: 100%; padding: 0.5rem;">
                        <option value="L">L (7%) - Low</option>
                        <option value="M" selected>M (15%) - Medium</option>
                        <option value="Q">Q (25%) - Quartile</option>
                        <option value="H">H (30%) - High</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                <div class="input-group">
                    <label>Foreground Color</label>
                    <input type="color" id="in-fg" value="#000000" style="width: 100%; height: 3rem;">
                </div>
                <div class="input-group">
                    <label>Background Color</label>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <input type="color" id="in-bg" value="#ffffff" style="flex: 1; height: 3rem;">
                        <label style="font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem;">
                            <input type="checkbox" id="in-trans"> Transparent
                        </label>
                    </div>
                </div>
            </div>

            <button id="btn-update" class="action-btn" style="width: 100%; margin-top: 1.5rem;">
                再生成 (Update)
            </button>
        </div>

        <!-- Preview -->
        <div class="result-panel"
            style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start;">
            <h2 style="font-size: 1.1rem; margin-bottom: 1rem; align-self: flex-start; color: var(--primary);">プレビュー
            </h2>

            <div
                style="background: rgba(255,255,255,0.05); padding: 2rem; border-radius: 1rem; display: flex; align-items: center; justify-content: center; width: 100%; min-height: 350px;">
                <canvas id="qr-canvas"></canvas>
            </div>

            <button id="btn-download" class="action-btn" style="margin-top: 1.5rem; width: 100%; max-width: 250px;">
                PNG保存 (Download)
            </button>
        </div>

    </main>

    <footer>
        <p>&copy; 2026 Simple Tools. All rights reserved.</p>
    </footer>

    <!-- Library & Logic -->
    <!-- Using CDN for QRious library -->
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

    <script type="module">
        import { QrLogic } from '../assets/js/modules/qr-logic.js';

        const inputs = {
            text: document.getElementById('in-text'),
            size: document.getElementById('in-size'),
            level: document.getElementById('in-level'),
            fg: document.getElementById('in-fg'),
            bg: document.getElementById('in-bg'),
            trans: document.getElementById('in-trans')
        };
        const btnUpdate = document.getElementById('btn-update');
        const btnDownload = document.getElementById('btn-download');
        const canvas = document.getElementById('qr-canvas');

        let qr;

        const update = () => {
            const val = inputs.text.value;
            if (!val) return;

            // Check if QRious is loaded
            if (typeof QRious === 'undefined') {
                console.error('QRious library not loaded');
                return;
            }

            qr = QrLogic.generate(QRious, canvas, {
                value: val,
                size: parseInt(inputs.size.value),
                level: inputs.level.value,
                foreground: inputs.fg.value,
                background: inputs.bg.value,
                transparent: inputs.trans.checked
            });
        };

        // Events
        ['input', 'change'].forEach(evt => {
            Object.values(inputs).forEach(el => el.addEventListener(evt, update));
        });

        btnDownload.addEventListener('click', () => {
            if (!qr) return;
            const link = document.createElement('a');
            link.download = 'qrcode.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        // Init
        // Wait for script load if needed, but normally deferred is fine
        if (typeof QRious !== 'undefined') {
            update();
        } else {
            window.addEventListener('load', update);
        }

    </script>
</body>

</html>