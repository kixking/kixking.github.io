<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正規表現チェッカー (Regex Tester)｜Simple Tools</title>
    <meta name="description" content="JavaScriptの正規表現をリアルタイムでテスト・検証できるツール。ハイライト表示とキャプチャグループの確認に対応。" />

    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4KCLTYQ3D1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-4KCLTYQ3D1');
    </script>
</head>

<body>
    <header>
        <h1>Regex Tester</h1>
        <p class="subtitle">正規表現パターンマッチング検証</p>
    </header>

    <div class="back-nav">
        <a href="/"><span>←</span> Home</a>
    </div>

    <main class="tool-container">

        <!-- Pattern Input -->
        <div style="margin-bottom: 2rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Pattern</label>
            <div
                style="display: flex; gap: 0.5rem; align-items: center; background: rgba(0,0,0,0.3); padding: 0.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <span style="color: var(--text-muted); font-family: monospace; font-size: 1.2rem;">/</span>
                <input type="text" id="in-pattern" placeholder="Expression..."
                    style="flex: 1; border: none; background: transparent; color: var(--text-main); font-family: monospace; font-size: 1.2rem; outline: none;">
                <span style="color: var(--text-muted); font-family: monospace; font-size: 1.2rem;">/</span>
                <input type="text" id="in-flags" placeholder="g" value="g"
                    style="width: 60px; border: none; background: transparent; color: var(--accent); font-family: monospace; font-size: 1.2rem; outline: none;">
            </div>
            <div style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted); display: flex; gap: 1rem;">
                <label><input type="checkbox" value="g" class="flag-chk" checked> Global (g)</label>
                <label><input type="checkbox" value="i" class="flag-chk"> Case Insensitive (i)</label>
                <label><input type="checkbox" value="m" class="flag-chk"> Multiline (m)</label>
            </div>
            <div id="error-msg" style="color: #ff6b6b; margin-top: 0.5rem; display: none;"></div>
        </div>

        <!-- Test String & Result Area -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

            <div class="group">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <label>Test String</label>
                    <button class="secondary-btn" id="btn-sample">Sample</button>
                </div>
                <!-- Use a transparent textarea over a div for highlight? Or just side-by-side? Side-by-side is easier for now -->
                <textarea id="in-text" placeholder="ここにテスト対象のテキストを入力..."
                    style="height: 300px; font-family: monospace; line-height: 1.5;"></textarea>
            </div>

            <div class="group">
                <label style="display: block; margin-bottom: 0.5rem;">Result (Highlight)</label>
                <div id="out-highlight"
                    style="height: 300px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; overflow: auto; font-family: monospace; white-space: pre-wrap; line-height: 1.5; color: #ccc;">
                </div>
                <div id="status-bar" style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--accent);">
                    Matches: 0
                </div>
            </div>

        </div>

        <!-- Match Details -->
        <div style="margin-top: 2rem;">
            <h3
                style="font-size: 1rem; color: var(--text-muted); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem;">
                Match Groups</h3>
            <ul id="match-list"
                style="list-style: none; padding: 0; margin-top: 1rem; font-family: monospace; font-size: 0.9em; max-height: 200px; overflow-y: auto;">
                <li style="color: #666;">No matches</li>
            </ul>
        </div>

    </main>

    <footer>
        <p>&copy; 2026 Simple Tools. All rights reserved.</p>
    </footer>

    <style>
        mark {
            background-color: rgba(74, 222, 128, 0.25);
            color: #4ade80;
            border-radius: 2px;
            padding: 0 1px;
        }

        mark:nth-of-type(odd) {
            background-color: rgba(59, 130, 246, 0.25);
            color: #60a5fa;
        }
    </style>

    <!-- Logic Script -->
    <script type="module">
        import { RegexLogic } from '../assets/js/modules/regex-logic.js';

        const inPattern = document.getElementById('in-pattern');
        const inFlags = document.getElementById('in-flags');
        const inText = document.getElementById('in-text');
        const flagChks = document.querySelectorAll('.flag-chk');

        const outHighlight = document.getElementById('out-highlight');
        const errorMsg = document.getElementById('error-msg');
        const statusBar = document.getElementById('status-bar');
        const matchList = document.getElementById('match-list');
        const btnSample = document.getElementById('btn-sample');

        const updateFlags = () => {
            const flags = Array.from(flagChks).filter(c => c.checked).map(c => c.value).join('');
            inFlags.value = flags;
            run();
        };

        const updateFlagChks = () => {
            const val = inFlags.value;
            flagChks.forEach(chk => {
                chk.checked = val.includes(chk.value);
            });
            run();
        };

        const run = () => {
            errorMsg.style.display = 'none';
            const pattern = inPattern.value;
            const flags = inFlags.value;
            const text = inText.value;

            if (!pattern) {
                outHighlight.textContent = text;
                statusBar.textContent = 'Matches: 0';
                matchList.innerHTML = '<li style="color: #666;">Enter a pattern</li>';
                return;
            }

            const result = RegexLogic.test(pattern, flags, text);

            if (result.error) {
                errorMsg.textContent = result.error;
                errorMsg.style.display = 'block';
                outHighlight.textContent = text; // no highlight
                return;
            }

            // Highlight
            outHighlight.innerHTML = RegexLogic.highlight(text, result.matches);
            statusBar.textContent = `Matches: ${result.matches.length}`;

            // List
            if (result.matches.length > 0) {
                matchList.innerHTML = result.matches.map((m, i) => {
                    let groupInfo = '';
                    if (m.groups && m.groups.length > 0) {
                        groupInfo = `<div style="padding-left: 1rem; color: var(--text-muted);">Groups: [${m.groups.map(g => `"${g}"`).join(', ')}]</div>`;
                    }
                    return `<li style="margin-bottom: 0.5rem; border-bottom: 1px dashed #333; padding-bottom: 0.2rem;">
                        <strong>#${i + 1}</strong> Index: ${m.index} <span style="color: var(--accent); background: rgba(255,255,255,0.05); padding: 0 4px;">${escapeHtml(m.text)}</span>
                        ${groupInfo}
                    </li>`;
                }).join('');
            } else {
                matchList.innerHTML = '<li style="color: #666;">No matches found</li>';
            }
        };

        const escapeHtml = (str) => {
            return str.replace(/[&<>"']/g, function (m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        };

        // Events
        inPattern.addEventListener('input', run);
        inText.addEventListener('input', run);
        inFlags.addEventListener('input', updateFlagChks);
        flagChks.forEach(chk => chk.addEventListener('change', updateFlags));

        btnSample.addEventListener('click', () => {
            inPattern.value = '[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}';
            flagChks.forEach(chk => {
                if (chk.value === 'g' || chk.value === 'i') chk.checked = true;
                else chk.checked = false;
            });
            inFlags.value = 'gi';
            inText.value = `Hello, please contact us at support@example.com or sales@example.org.
Invalid emails: unknown@ @domain.com`;
            run();
        });

    </script>
</body>

</html>